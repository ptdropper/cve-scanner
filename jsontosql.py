import json
import sqlite3

# The string representing the json.
# You will probably want to read this string in from
# a file rather than hardcoding it.
s = """[
    {
        "id": 1001, 
        "name": "John", 
        "age" : 30 
    }, 
    {
        "id" : 1002,
        "name" : "Peter",
        "age" : 25
    },
    {
        "id" : 1002,
        "name" : "Kevin",
        "age" : 35,
        "salary" : 5000
    }
]"""

phones = """[
    {
        "id": 1001, 
        "phone": "123456789"
    }, 
    {
        "id" : 1002,
        "phone" : "8675309"
    },
    {
        "id" : 1002,
        "phone" : "987654321"
    }
]"""

# Read the string representing json
# Into a python list of dicts.
data = json.loads(s)

phonelist = json.loads(phones)

# Open the file containing the SQL database.
with sqlite3.connect("filename.db") as conn:

    # Create the table if it doesn't exist.
    conn.execute(
        """CREATE TABLE IF NOT EXISTS tab(
                id int,
                name varchar(100),
                age int,
                salary int
            );"""
        )

    # Insert each entry from json into the table.
    keys = ["id", "name", "age", "salary"]
    for entry in data:

        # This will make sure that each key will default to None
        # if the key doesn't exist in the json entry.
        values = [entry.get(key, None) for key in keys]

        # Execute the command and replace '?' with the each value
        # in 'values'. DO NOT build a string and replace manually.
        # the sqlite3 library will handle non safe strings by doing this.
        cmd = """INSERT INTO tab VALUES(
                    ?,
                    ?,
                    ?,
                    ?
                );"""
        conn.execute(cmd, values)

    conn.commit()
    
    # Create the table if it doesn't exist.
    conn.execute(
        """CREATE TABLE IF NOT EXISTS phonetab(
                id int,
                phone varchar(100)
            );"""
        )

    # Insert each entry from json into the table.
    keys = ["id", "phone"]
    for entry in phonelist:

        # This will make sure that each key will default to None
        # if the key doesn't exist in the json entry.
        values = [entry.get(key, None) for key in keys]

        # Execute the command and replace '?' with the each value
        # in 'values'. DO NOT build a string and replace manually.
        # the sqlite3 library will handle non safe strings by doing this.
        cmd = """INSERT INTO phonetab VALUES(
                    ?,
                    ?
                );"""
        conn.execute(cmd, values)

    conn.commit()
        
# Testing the table.
with sqlite3.connect("filename.db") as conn:
    cmd = """SELECT * FROM tab WHERE SALARY NOT NULL;"""
    cur = conn.execute(cmd)
    res = cur.fetchall()
    for r in res:
        print(r)
        
        
    cmd = """SELECT tab.name,phonetab.phone FROM tab INNER JOIN phonetab ON tab.id=phonetab.id;"""
    cur = conn.execute(cmd)
    res = cur.fetchall()
    for r in res:
        print(r)        
