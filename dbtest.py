import sqlite3    
from os import listdir
import os
  
print("Testing the table")

files = [f for f in listdir("./") if f.endswith('.json.zip.db')]
files.sort()
file_index=1

for file in files:

    with sqlite3.connect(file) as conn:        
        cmd = """SELECT nist.current_cve_id,nist.nist_json_cve_entry FROM nist INNER JOIN package_table ON nist.nist_json_cve_entry LIKE '%' || package_table.nist_json_cve_entry || '%' ;"""
        cur = conn.execute(cmd)
        res = cur.fetchall()
        conn.commit()
        print("database join complete")
        my_final_set = set(res)    # unique
        my_final_list = sorted(my_final_set) # sorted again due to undefined sort in the set() 
        print("list is sorted")
        for x in range(len(my_final_list)):
            print(my_final_list[x])        
        file_index+=1
        conn.commit()
