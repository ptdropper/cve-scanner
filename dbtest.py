import sqlite3    
from os import listdir
import os
  
print("Searching database software package names with CVE issues")

files = [f for f in listdir("./") if f.endswith('.json.zip.db')]
files.sort()
file_index=1
package_table_list = ["comsystem3_input","spacecom2_input","spacecomlite_input"]
for package_table in package_table_list:
    for file in files:

        with sqlite3.connect(file) as conn:        
            cmd = "" + "SELECT nist.current_cve_id,nist.nist_json_cve_entry,nist.current_cve_description FROM nist INNER JOIN " + package_table + " ON nist.nist_json_cve_entry LIKE '%' || " + package_table + ".nist_json_cve_entry || '%' ;" + ""
            
            cur = conn.execute(cmd)
            res = cur.fetchall()
            conn.commit()
            my_final_set = set(res)    # unique
            my_final_list = sorted(my_final_set) # sorted again due to undefined sort in the set()             
            for x in range(len(my_final_list)):                                               
                print(my_final_list[x][0])
                print(my_final_list[x][1])
                print(my_final_list[x][2])
                print()
            file_index+=1
    #endfor
#endfor
